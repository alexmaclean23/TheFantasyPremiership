document.addEventListener("DOMContentLoaded",sheetdb_upd);var sheetdb_template_cache=[],sheetdb_template_slots_cache=[],sheetdb_items=[],sheetdb_slots=[];function sheetdb_upd(){for(var t,e=document.querySelectorAll("[data-sheetdb-url]"),y=e.length,s=0;t=e[s];s++)!function(n,d){sheetdb_template_cache[n]||(sheetdb_template_cache[n]=d.innerHTML);var t=d.dataset.sheetdbSearch,e=d.dataset.sheetdbLimit,s=d.dataset.sheetdbOffset,o=d.dataset.sheetdbSortBy,a=d.dataset.sheetdbSortOrder,r=d.dataset.sheetdbSortMethod,h=d.dataset.sheetdbSortDateFormat,c=d.dataset.sheetdbGroupBy,l=d.dataset.sheetdbGroupByWithCount,i=d.dataset.sheetdbSearchMode,u=d.dataset.sheetdbSheet,_=d.dataset.sheetdbNotFoundMessage,b=!1;slot=d.dataset.sheetdbSave,slot&&!sheetdb_slots[slot]&&(sheetdb_slots[slot]=[]);var p=t;if(d.dataset.sheetdbQueryString){var f=new URLSearchParams(window.location.search),m=d.dataset.sheetdbQueryString.split(",");let s=0;m.forEach(t=>{var e=f.get(t),t=t+"="+e;null!=e&&s++,p?p+="&"+t:p=t}),0===s&&(b=!0)}m=d.dataset.sheetdbUrl,p&&(m=m.endsWith("/")?m:m+"/",i&&"or"==i.toLowerCase()?m+="search_or":m+="search"),d.style.display="none",completed=0,sheetdbMakeSlotTemplateCache(),sheetdbFetchData({URL:m,search:p,limit:e,offset:s,sort_by:o,sort_order:a,sort_method:r,sort_date_format:h,group_by:c,group_by_with_count:l,sheet:u,slot:slot,skip_sheetdb_request:b}).then(function(t){data=t.response,slot=t.current_slot,sheetdb_items[n]=data,completed++;for(var e=[],s=0;s<data.length;s++)e.push(sheetdb_template_cache[n]);var o=[],a=e.map(function(t,e){return o.push(data[e]),sheetdbInterpolateString(t,data[e])});if(slot)for(var r in o)sheetdb_slots[slot][r],o.hasOwnProperty(r)&&(sheetdb_slots[slot][r]=o[r]);d.innerHTML=a.join(""),d.style.display="",0===t.response.length&&_&&(d.appendChild(document.createElement("p")).innerHTML=_),d.dispatchEvent(new CustomEvent("sheetdb-downloaded")),y==completed&&(sheetdbUpdateSlots(),window.dispatchEvent(new CustomEvent("sheetdb-downloaded")))}).catch(function(t){throw new Error(t)})}(s,t)}function sheetdbFetchData(t){if(1==t.skip_sheetdb_request)return new Promise(function(t,e){return t({response:[]})});var e=t.URL,s=t.search,o=t.limit,a=t.offset,r=t.sort_by,n=t.sort_order,d=t.sort_method,h=t.sort_date_format,c=t.group_by,l=t.group_by_with_count,i=t.sheet,u=slot,t=(t=[i?"sheet=".concat(i):"",r?"sort_by=".concat(r):"",n?"sort_order=".concat(n):"",d?"sort_method=".concat(d):"",h?"sort_date_format=".concat(h):"",c?"group_by=".concat(c):"",l?"group_by_with_count=".concat(l):"",o?"limit=".concat(o):"",a?"offset=".concat(a):"",s?"".concat(s):""]).filter(function(t){return""!=t}),_="".concat(e);return(r||n||d||h||c||l||o||a||s||i)&&(_=(e.includes("?")?"".concat(e,"&"):"".concat(e,"?")).concat(t.join("&"))),new Promise(function(e,s){fetch(_).then(function(t){return t.json()}).then(function(t){return e({response:t,current_slot:u})}).catch(function(t){return s(t)})})}function sheetdbInterpolateString(t,s){return t.replace(/{{([^{}]*)}}/g,function(t,e){e=s[e];return"string"==typeof e?e:t})}function sheetdbMakeSlotTemplateCache(){for(var t,e=document.querySelectorAll("[data-sheetdb-slot]"),s=0;t=e[s];s++)sheetdb_template_slots_cache[s]||(sheetdb_template_slots_cache[s]=t.innerHTML)}function sheetdbUpdateSlots(){for(var t,e=document.querySelectorAll("[data-sheetdb-slot]"),s=0;t=e[s];s++){for(var o=t.dataset.sheetdbSlot,a=[],r=0;r<sheetdb_slots[o].length;r++)a.push(sheetdb_template_slots_cache[s]);var n=a.map(function(t,e){return sheetdbInterpolateString(t,sheetdb_slots[o][e])});t.innerHTML=n.join(""),t.style.display=""}}